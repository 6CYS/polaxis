# 开发指南 (Development Guide)

## 1. 环境准备 (Prerequisites)

为了顺利开发本项目，你需要安装以下工具。

- **Node.js**: v18.17.0 或更高版本 (建议 v20 LTS)。
- **包管理器**: 推荐 `pnpm` 或 `npm` (本项目默认使用 npm)。
- **Git**: 必装，用于版本控制。
- **VS Code**: 推荐编辑器。
  - **建议插件**:
    - ES7+ React/Redux/React-Native snippets
    - Tailwind CSS IntelliSense (**强烈推荐**)
    - Prettier - Code formatter
    - Supabase (官方插件)

## 2. 项目初始化 (Getting Started)

我们提供了一键初始化脚本，自动完成 Next.js 脚手架创建、依赖安装、UI 组件库配置和目录结构整理。

### 2.1 一键初始化 (推荐)
如果你已安装 `just`：
```bash
just init
```

或者直接运行脚本：
```bash
./scripts/init-project.sh
```

**脚本自动完成以下工作**：
- 创建 Next.js (App Router, TypeScript)
- 安装 Tailwind CSS, Shadcn/ui
- 安装 Supabase SDK
- 生成 `src/lib/supabase.ts`
- 生成 `.env.local` 模板

### 2.2 下一步
脚本运行完成后，请根据控制台提示配置 `.env.local` 中的 Supabase Key。

## 3. 环境变量配置 (.env.local)

在项目根目录创建 `.env.local` 文件，填入你的 Supabase 项目凭证。

```properties
# Supabase 连接信息 (从 Supabase Dashboard -> Settings -> API 获取)
NEXT_PUBLIC_SUPABASE_URL=https://your-project-ref.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI...

# 服务端专用 Key (用于 Next.js API Route 中绕过 RLS 权限读取文件)
# !注意! 绝对不要在前端代码中使用此 Key
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI...
```

## 4. 数据库与存储设置

### 4.1 运行 SQL 脚本
登录 Supabase Dashboard -> SQL Editor -> New Query，复制 `docs/03_数据库与存储设计.md` 中的 SQL 脚本并运行：
- 创建 `po_sites` 表。
- 启用 RLS 策略。

### 4.2 创建 Storage Bucket
1. 进入 Storage 页面。
2. 创建一个名为 `sites` 的 Bucket。
3. 确保 Public Access 设置为 **Disabled** (私有)。
4. (可选) 添加 Storage Policy (参考设计文档)。

## 5. 本地开发命令

我们推荐使用 [Just](https://github.com/casey/just) 来管理项目命令，更加简洁方便。

### 5.1 安装 Just
- **macOS**: `brew install just`
- **Windows**: `scoop install just` 或 `choco install just`
- **Linux**: 包管理器安装 (如 `apt install just`)

### 5.2 常用命令
```bash
# 列出所有命令
just

# 启动开发服务器
just dev

# 安装依赖
just install

# 构建项目
just build
```

如果你不习惯使用 Just，也可以继续使用标准的 NPM 命令：
```bash
npm run dev
npm run build
npm run lint
```

## 6. 目录结构说明

```
/src
  /app
    /(auth)/login/page.tsx   # 登录页
    /(dashboard)/dashboard/  # 管理后台
    /s/[user]/[slug]/        # 站点访问路由
  /components
    /ui/                     # shadcn 组件 (自动生成)
    /auth-form.tsx           # 登录表单组件
  /lib
    /supabase.ts             # 客户端实例化
```
