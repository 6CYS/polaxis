# 开发指南 (Development Guide)

## 1. 环境准备 (Prerequisites)

为了顺利开发本项目，你需要安装以下工具。

- **Node.js**: v18.17.0 或更高版本 (建议 v20 LTS)。
- **包管理器**: 推荐 `pnpm` 或 `npm` (本项目默认使用 npm)。
- **Git**: 必装，用于版本控制。
- **VS Code**: 推荐编辑器。
  - **建议插件**:
    - ES7+ React/Redux/React-Native snippets
    - Tailwind CSS IntelliSense (**强烈推荐**)
    - Prettier - Code formatter
    - Supabase (官方插件)

## 2. 项目初始化 (Getting Started)

### 2.1 克隆与安装依赖
```bash
# 如果是首次创建
npx create-next-app@latest html-hosting
cd html-hosting

# 如果是克隆现有代码
git clone <repo-url>
cd <repo-name>
npm install
```

### 2.2 初始化 shadcn/ui
```bash
npx shadcn-ui@latest init
# 按照提示选择默认配置即可 (推荐 Slate 风格)
```

### 2.3 安装 Supabase 客户端
```bash
npm install @supabase/supabase-js
```

## 3. 环境变量配置 (.env.local)

在项目根目录创建 `.env.local` 文件，填入你的 Supabase 项目凭证。

```properties
# Supabase 连接信息 (从 Supabase Dashboard -> Settings -> API 获取)
NEXT_PUBLIC_SUPABASE_URL=https://your-project-ref.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI...

# 服务端专用 Key (用于 Next.js API Route 中绕过 RLS 权限读取文件)
# !注意! 绝对不要在前端代码中使用此 Key
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI...
```

## 4. 数据库与存储设置

### 4.1 运行 SQL 脚本
登录 Supabase Dashboard -> SQL Editor -> New Query，复制 `docs/03_数据库与存储设计.md` 中的 SQL 脚本并运行：
- 创建 `po_sites` 表。
- 启用 RLS 策略。

### 4.2 创建 Storage Bucket
1. 进入 Storage 页面。
2. 创建一个名为 `sites` 的 Bucket。
3. 确保 Public Access 设置为 **Disabled** (私有)。
4. (可选) 添加 Storage Policy (参考设计文档)。

## 5. 本地开发命令

```bash
# 启动开发服务器
npm run dev
# 访问 http://localhost:3000

# 运行 Lint 检查
npm run lint

# 构建生产版本
npm run build
npm start
```

## 6. 目录结构说明

```
/app
  /(auth)/login/page.tsx   # 登录页
  /(dashboard)/dashboard/  # 管理后台
  /s/[user]/[slug]/        # 站点访问路由
/components
  /ui/                     # shadcn 组件 (自动生成)
  /auth-form.tsx           # 登录表单组件
/lib
  /supabase.ts             # 客户端实例化
```
